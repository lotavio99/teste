from osgeo import ogr, osr
import os

# Parâmetros
input_shp = r"C:\caminho\para\sua_linha.shp"
output_shp = r"C:\caminho\para\pontos_saida.shp"
spacing = 1  # metro

# Abrir shapefile de entrada
driver = ogr.GetDriverByName("ESRI Shapefile")
data_source = driver.Open(input_shp, 0)
layer = data_source.GetLayer()
spatial_ref = layer.GetSpatialRef()

# Criar shapefile de saída
if os.path.exists(output_shp):
    driver.DeleteDataSource(output_shp)
out_ds = driver.CreateDataSource(output_shp)
out_layer = out_ds.CreateLayer("pontos", spatial_ref, ogr.wkbPoint)

# Copiar os campos (atributos)
layer_defn = layer.GetLayerDefn()
for i in range(layer_defn.GetFieldCount()):
    field_defn = layer_defn.GetFieldDefn(i)
    out_layer.CreateField(field_defn)

# Adicionar campo extra com distância opcional (ex: position)
out_layer.CreateField(ogr.FieldDefn("dist_m", ogr.OFTReal))

# Processar cada linha
for feature in layer:
    geom = feature.GetGeometryRef()
    length = geom.Length()
    dist = 0.0
    while dist <= length:
        point = geom.Value(dist) if hasattr(geom, 'Value') else geom.Interpolate(dist)
        out_feat = ogr.Feature(out_layer.GetLayerDefn())
        out_feat.SetGeometry(point)

        # Copiar atributos da linha original
        for i in range(layer_defn.GetFieldCount()):
            out_feat.SetField(layer_defn.GetFieldDefn(i).GetNameRef(), feature.GetField(i))
        
        out_feat.SetField("dist_m", dist)
        out_layer.CreateFeature(out_feat)
        out_feat = None
        dist += spacing

# Finalizar
layer = None
data_source = None
out_ds = None

print("Pontos gerados com sucesso.")
